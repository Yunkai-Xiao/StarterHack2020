{"ast":null,"code":"/**\n * align dom node flexibly\n * @author yiminghe@gmail.com\n */\nimport utils from '../utils';\nimport getVisibleRectForElement from '../getVisibleRectForElement';\nimport adjustForViewport from '../adjustForViewport';\nimport getRegion from '../getRegion';\nimport getElFuturePos from '../getElFuturePos'; // http://yiminghe.iteye.com/blog/1124720\n\nfunction isFailX(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.left < visibleRect.left || elFuturePos.left + elRegion.width > visibleRect.right;\n}\n\nfunction isFailY(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.top < visibleRect.top || elFuturePos.top + elRegion.height > visibleRect.bottom;\n}\n\nfunction isCompleteFailX(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.left > visibleRect.right || elFuturePos.left + elRegion.width < visibleRect.left;\n}\n\nfunction isCompleteFailY(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.top > visibleRect.bottom || elFuturePos.top + elRegion.height < visibleRect.top;\n}\n\nfunction flip(points, reg, map) {\n  var ret = [];\n  utils.each(points, function (p) {\n    ret.push(p.replace(reg, function (m) {\n      return map[m];\n    }));\n  });\n  return ret;\n}\n\nfunction flipOffset(offset, index) {\n  offset[index] = -offset[index];\n  return offset;\n}\n\nfunction convertOffset(str, offsetLen) {\n  var n = void 0;\n\n  if (/%$/.test(str)) {\n    n = parseInt(str.substring(0, str.length - 1), 10) / 100 * offsetLen;\n  } else {\n    n = parseInt(str, 10);\n  }\n\n  return n || 0;\n}\n\nfunction normalizeOffset(offset, el) {\n  offset[0] = convertOffset(offset[0], el.width);\n  offset[1] = convertOffset(offset[1], el.height);\n}\n/**\n * @param el\n * @param tgtRegion 参照节点所占的区域: { left, top, width, height }\n * @param align\n */\n\n\nfunction doAlign(el, tgtRegion, align, isTgtRegionVisible) {\n  var points = align.points;\n  var offset = align.offset || [0, 0];\n  var targetOffset = align.targetOffset || [0, 0];\n  var overflow = align.overflow;\n  var source = align.source || el;\n  offset = [].concat(offset);\n  targetOffset = [].concat(targetOffset);\n  overflow = overflow || {};\n  var newOverflowCfg = {};\n  var fail = 0; // 当前节点可以被放置的显示区域\n\n  var visibleRect = getVisibleRectForElement(source); // 当前节点所占的区域, left/top/width/height\n\n  var elRegion = getRegion(source); // 将 offset 转换成数值，支持百分比\n\n  normalizeOffset(offset, elRegion);\n  normalizeOffset(targetOffset, tgtRegion); // 当前节点将要被放置的位置\n\n  var elFuturePos = getElFuturePos(elRegion, tgtRegion, points, offset, targetOffset); // 当前节点将要所处的区域\n\n  var newElRegion = utils.merge(elRegion, elFuturePos); // 如果可视区域不能完全放置当前节点时允许调整\n\n  if (visibleRect && (overflow.adjustX || overflow.adjustY) && isTgtRegionVisible) {\n    if (overflow.adjustX) {\n      // 如果横向不能放下\n      if (isFailX(elFuturePos, elRegion, visibleRect)) {\n        // 对齐位置反下\n        var newPoints = flip(points, /[lr]/ig, {\n          l: 'r',\n          r: 'l'\n        }); // 偏移量也反下\n\n        var newOffset = flipOffset(offset, 0);\n        var newTargetOffset = flipOffset(targetOffset, 0);\n        var newElFuturePos = getElFuturePos(elRegion, tgtRegion, newPoints, newOffset, newTargetOffset);\n\n        if (!isCompleteFailX(newElFuturePos, elRegion, visibleRect)) {\n          fail = 1;\n          points = newPoints;\n          offset = newOffset;\n          targetOffset = newTargetOffset;\n        }\n      }\n    }\n\n    if (overflow.adjustY) {\n      // 如果纵向不能放下\n      if (isFailY(elFuturePos, elRegion, visibleRect)) {\n        // 对齐位置反下\n        var _newPoints = flip(points, /[tb]/ig, {\n          t: 'b',\n          b: 't'\n        }); // 偏移量也反下\n\n\n        var _newOffset = flipOffset(offset, 1);\n\n        var _newTargetOffset = flipOffset(targetOffset, 1);\n\n        var _newElFuturePos = getElFuturePos(elRegion, tgtRegion, _newPoints, _newOffset, _newTargetOffset);\n\n        if (!isCompleteFailY(_newElFuturePos, elRegion, visibleRect)) {\n          fail = 1;\n          points = _newPoints;\n          offset = _newOffset;\n          targetOffset = _newTargetOffset;\n        }\n      }\n    } // 如果失败，重新计算当前节点将要被放置的位置\n\n\n    if (fail) {\n      elFuturePos = getElFuturePos(elRegion, tgtRegion, points, offset, targetOffset);\n      utils.mix(newElRegion, elFuturePos);\n    }\n\n    var isStillFailX = isFailX(elFuturePos, elRegion, visibleRect);\n    var isStillFailY = isFailY(elFuturePos, elRegion, visibleRect); // 检查反下后的位置是否可以放下了，如果仍然放不下：\n    // 1. 复原修改过的定位参数\n\n    if (isStillFailX || isStillFailY) {\n      points = align.points;\n      offset = align.offset || [0, 0];\n      targetOffset = align.targetOffset || [0, 0];\n    } // 2. 只有指定了可以调整当前方向才调整\n\n\n    newOverflowCfg.adjustX = overflow.adjustX && isStillFailX;\n    newOverflowCfg.adjustY = overflow.adjustY && isStillFailY; // 确实要调整，甚至可能会调整高度宽度\n\n    if (newOverflowCfg.adjustX || newOverflowCfg.adjustY) {\n      newElRegion = adjustForViewport(elFuturePos, elRegion, visibleRect, newOverflowCfg);\n    }\n  } // need judge to in case set fixed with in css on height auto element\n\n\n  if (newElRegion.width !== elRegion.width) {\n    utils.css(source, 'width', utils.width(source) + newElRegion.width - elRegion.width);\n  }\n\n  if (newElRegion.height !== elRegion.height) {\n    utils.css(source, 'height', utils.height(source) + newElRegion.height - elRegion.height);\n  } // https://github.com/kissyteam/kissy/issues/190\n  // 相对于屏幕位置没变，而 left/top 变了\n  // 例如 <div 'relative'><el absolute></div>\n\n\n  utils.offset(source, {\n    left: newElRegion.left,\n    top: newElRegion.top\n  }, {\n    useCssRight: align.useCssRight,\n    useCssBottom: align.useCssBottom,\n    useCssTransform: align.useCssTransform,\n    ignoreShake: align.ignoreShake\n  });\n  return {\n    points: points,\n    offset: offset,\n    targetOffset: targetOffset,\n    overflow: newOverflowCfg\n  };\n}\n\nexport default doAlign;\n/**\n *  2012-04-26 yiminghe@gmail.com\n *   - 优化智能对齐算法\n *   - 慎用 resizeXX\n *\n *  2011-07-13 yiminghe@gmail.com note:\n *   - 增加智能对齐，以及大小调整选项\n **/","map":{"version":3,"sources":["/Users/SHAWN/Downloads/StudyMate2/node_modules/dom-align/es/align/align.js"],"names":["utils","getVisibleRectForElement","adjustForViewport","getRegion","getElFuturePos","isFailX","elFuturePos","elRegion","visibleRect","left","width","right","isFailY","top","height","bottom","isCompleteFailX","isCompleteFailY","flip","points","reg","map","ret","each","p","push","replace","m","flipOffset","offset","index","convertOffset","str","offsetLen","n","test","parseInt","substring","length","normalizeOffset","el","doAlign","tgtRegion","align","isTgtRegionVisible","targetOffset","overflow","source","concat","newOverflowCfg","fail","newElRegion","merge","adjustX","adjustY","newPoints","l","r","newOffset","newTargetOffset","newElFuturePos","_newPoints","t","b","_newOffset","_newTargetOffset","_newElFuturePos","mix","isStillFailX","isStillFailY","css","useCssRight","useCssBottom","useCssTransform","ignoreShake"],"mappings":"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","sourcesContent":["/**\n * align dom node flexibly\n * @author yiminghe@gmail.com\n */\n\nimport utils from '../utils';\nimport getVisibleRectForElement from '../getVisibleRectForElement';\nimport adjustForViewport from '../adjustForViewport';\nimport getRegion from '../getRegion';\nimport getElFuturePos from '../getElFuturePos';\n\n// http://yiminghe.iteye.com/blog/1124720\n\nfunction isFailX(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.left < visibleRect.left || elFuturePos.left + elRegion.width > visibleRect.right;\n}\n\nfunction isFailY(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.top < visibleRect.top || elFuturePos.top + elRegion.height > visibleRect.bottom;\n}\n\nfunction isCompleteFailX(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.left > visibleRect.right || elFuturePos.left + elRegion.width < visibleRect.left;\n}\n\nfunction isCompleteFailY(elFuturePos, elRegion, visibleRect) {\n  return elFuturePos.top > visibleRect.bottom || elFuturePos.top + elRegion.height < visibleRect.top;\n}\n\nfunction flip(points, reg, map) {\n  var ret = [];\n  utils.each(points, function (p) {\n    ret.push(p.replace(reg, function (m) {\n      return map[m];\n    }));\n  });\n  return ret;\n}\n\nfunction flipOffset(offset, index) {\n  offset[index] = -offset[index];\n  return offset;\n}\n\nfunction convertOffset(str, offsetLen) {\n  var n = void 0;\n  if (/%$/.test(str)) {\n    n = parseInt(str.substring(0, str.length - 1), 10) / 100 * offsetLen;\n  } else {\n    n = parseInt(str, 10);\n  }\n  return n || 0;\n}\n\nfunction normalizeOffset(offset, el) {\n  offset[0] = convertOffset(offset[0], el.width);\n  offset[1] = convertOffset(offset[1], el.height);\n}\n\n/**\n * @param el\n * @param tgtRegion 参照节点所占的区域: { left, top, width, height }\n * @param align\n */\nfunction doAlign(el, tgtRegion, align, isTgtRegionVisible) {\n  var points = align.points;\n  var offset = align.offset || [0, 0];\n  var targetOffset = align.targetOffset || [0, 0];\n  var overflow = align.overflow;\n  var source = align.source || el;\n  offset = [].concat(offset);\n  targetOffset = [].concat(targetOffset);\n  overflow = overflow || {};\n  var newOverflowCfg = {};\n  var fail = 0;\n  // 当前节点可以被放置的显示区域\n  var visibleRect = getVisibleRectForElement(source);\n  // 当前节点所占的区域, left/top/width/height\n  var elRegion = getRegion(source);\n  // 将 offset 转换成数值，支持百分比\n  normalizeOffset(offset, elRegion);\n  normalizeOffset(targetOffset, tgtRegion);\n  // 当前节点将要被放置的位置\n  var elFuturePos = getElFuturePos(elRegion, tgtRegion, points, offset, targetOffset);\n  // 当前节点将要所处的区域\n  var newElRegion = utils.merge(elRegion, elFuturePos);\n\n  // 如果可视区域不能完全放置当前节点时允许调整\n  if (visibleRect && (overflow.adjustX || overflow.adjustY) && isTgtRegionVisible) {\n    if (overflow.adjustX) {\n      // 如果横向不能放下\n      if (isFailX(elFuturePos, elRegion, visibleRect)) {\n        // 对齐位置反下\n        var newPoints = flip(points, /[lr]/ig, {\n          l: 'r',\n          r: 'l'\n        });\n        // 偏移量也反下\n        var newOffset = flipOffset(offset, 0);\n        var newTargetOffset = flipOffset(targetOffset, 0);\n        var newElFuturePos = getElFuturePos(elRegion, tgtRegion, newPoints, newOffset, newTargetOffset);\n\n        if (!isCompleteFailX(newElFuturePos, elRegion, visibleRect)) {\n          fail = 1;\n          points = newPoints;\n          offset = newOffset;\n          targetOffset = newTargetOffset;\n        }\n      }\n    }\n\n    if (overflow.adjustY) {\n      // 如果纵向不能放下\n      if (isFailY(elFuturePos, elRegion, visibleRect)) {\n        // 对齐位置反下\n        var _newPoints = flip(points, /[tb]/ig, {\n          t: 'b',\n          b: 't'\n        });\n        // 偏移量也反下\n        var _newOffset = flipOffset(offset, 1);\n        var _newTargetOffset = flipOffset(targetOffset, 1);\n        var _newElFuturePos = getElFuturePos(elRegion, tgtRegion, _newPoints, _newOffset, _newTargetOffset);\n\n        if (!isCompleteFailY(_newElFuturePos, elRegion, visibleRect)) {\n          fail = 1;\n          points = _newPoints;\n          offset = _newOffset;\n          targetOffset = _newTargetOffset;\n        }\n      }\n    }\n\n    // 如果失败，重新计算当前节点将要被放置的位置\n    if (fail) {\n      elFuturePos = getElFuturePos(elRegion, tgtRegion, points, offset, targetOffset);\n      utils.mix(newElRegion, elFuturePos);\n    }\n    var isStillFailX = isFailX(elFuturePos, elRegion, visibleRect);\n    var isStillFailY = isFailY(elFuturePos, elRegion, visibleRect);\n    // 检查反下后的位置是否可以放下了，如果仍然放不下：\n    // 1. 复原修改过的定位参数\n    if (isStillFailX || isStillFailY) {\n      points = align.points;\n      offset = align.offset || [0, 0];\n      targetOffset = align.targetOffset || [0, 0];\n    }\n    // 2. 只有指定了可以调整当前方向才调整\n    newOverflowCfg.adjustX = overflow.adjustX && isStillFailX;\n    newOverflowCfg.adjustY = overflow.adjustY && isStillFailY;\n\n    // 确实要调整，甚至可能会调整高度宽度\n    if (newOverflowCfg.adjustX || newOverflowCfg.adjustY) {\n      newElRegion = adjustForViewport(elFuturePos, elRegion, visibleRect, newOverflowCfg);\n    }\n  }\n\n  // need judge to in case set fixed with in css on height auto element\n  if (newElRegion.width !== elRegion.width) {\n    utils.css(source, 'width', utils.width(source) + newElRegion.width - elRegion.width);\n  }\n\n  if (newElRegion.height !== elRegion.height) {\n    utils.css(source, 'height', utils.height(source) + newElRegion.height - elRegion.height);\n  }\n\n  // https://github.com/kissyteam/kissy/issues/190\n  // 相对于屏幕位置没变，而 left/top 变了\n  // 例如 <div 'relative'><el absolute></div>\n  utils.offset(source, {\n    left: newElRegion.left,\n    top: newElRegion.top\n  }, {\n    useCssRight: align.useCssRight,\n    useCssBottom: align.useCssBottom,\n    useCssTransform: align.useCssTransform,\n    ignoreShake: align.ignoreShake\n  });\n\n  return {\n    points: points,\n    offset: offset,\n    targetOffset: targetOffset,\n    overflow: newOverflowCfg\n  };\n}\n\nexport default doAlign;\n/**\n *  2012-04-26 yiminghe@gmail.com\n *   - 优化智能对齐算法\n *   - 慎用 resizeXX\n *\n *  2011-07-13 yiminghe@gmail.com note:\n *   - 增加智能对齐，以及大小调整选项\n **/"]},"metadata":{},"sourceType":"module"}