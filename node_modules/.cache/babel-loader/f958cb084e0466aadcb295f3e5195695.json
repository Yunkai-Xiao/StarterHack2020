{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/no-is-mounted:0 react/sort-comp:0 */\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\n\nvar AjaxUploader = function (_Component) {\n  _inherits(AjaxUploader, _Component);\n\n  function AjaxUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, AjaxUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = AjaxUploader.__proto__ || Object.getPrototypeOf(AjaxUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      uid: getUid()\n    }, _this.reqs = {}, _this.onChange = function (e) {\n      var files = e.target.files;\n\n      _this.uploadFiles(files);\n\n      _this.reset();\n    }, _this.onClick = function () {\n      var el = _this.fileInput;\n\n      if (!el) {\n        return;\n      }\n\n      el.click();\n    }, _this.onKeyDown = function (e) {\n      if (e.key === 'Enter') {\n        _this.onClick();\n      }\n    }, _this.onFileDrop = function (e) {\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (_this.props.directory) {\n        traverseFileTree(e.dataTransfer.items, _this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.props.accept);\n        });\n      } else {\n        var files = Array.prototype.slice.call(e.dataTransfer.files).filter(function (file) {\n          return attrAccept(file, _this.props.accept);\n        });\n\n        _this.uploadFiles(files);\n      }\n    }, _this.uploadFiles = function (files) {\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.forEach(function (file) {\n        file.uid = getUid();\n\n        _this.upload(file, postFiles);\n      });\n    }, _this.saveFileInput = function (node) {\n      _this.fileInput = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(AjaxUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.abort();\n    }\n  }, {\n    key: 'upload',\n    value: function upload(file, fileList) {\n      var _this2 = this;\n\n      var props = this.props;\n\n      if (!props.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n\n      var before = props.beforeUpload(file, fileList);\n\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this2.post(processedFile);\n          }\n\n          return _this2.post(file);\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this3 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n\n      var props = this.props;\n      var data = props.data;\n      var onStart = props.onStart,\n          onProgress = props.onProgress;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      new Promise(function (resolve) {\n        var action = props.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n        var request = props.customRequest || defaultRequest;\n        _this3.reqs[uid] = request({\n          action: action,\n          filename: props.name,\n          file: file,\n          data: data,\n          headers: props.headers,\n          withCredentials: props.withCredentials,\n          onProgress: onProgress ? function (e) {\n            onProgress(e, file);\n          } : null,\n          onSuccess: function onSuccess(ret, xhr) {\n            delete _this3.reqs[uid];\n            props.onSuccess(ret, file, xhr);\n          },\n          onError: function onError(err, ret) {\n            delete _this3.reqs[uid];\n            props.onError(err, ret, file);\n          }\n        });\n        onStart(file);\n      });\n    }\n  }, {\n    key: 'reset',\n    value: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (reqs[uid]) {\n          reqs[uid].abort();\n          delete reqs[uid];\n        }\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid]) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          prefixCls = _props.prefixCls,\n          className = _props.className,\n          disabled = _props.disabled,\n          id = _props.id,\n          style = _props.style,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          children = _props.children,\n          directory = _props.directory,\n          openFileDialogOnClick = _props.openFileDialogOnClick;\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      var events = disabled ? {} : {\n        onClick: openFileDialogOnClick ? this.onClick : function () {},\n        onKeyDown: this.onKeyDown,\n        onDrop: this.onFileDrop,\n        onDragOver: this.onFileDrop,\n        tabIndex: '0'\n      };\n      return React.createElement(Tag, _extends({}, events, {\n        className: cls,\n        role: 'button',\n        style: style\n      }), React.createElement('input', {\n        id: id,\n        type: 'file',\n        ref: this.saveFileInput,\n        key: this.state.uid,\n        style: {\n          display: 'none'\n        },\n        accept: accept,\n        directory: directory ? 'directory' : null,\n        webkitdirectory: directory ? 'webkitdirectory' : null,\n        multiple: multiple,\n        onChange: this.onChange\n      }), children);\n    }\n  }]);\n\n  return AjaxUploader;\n}(Component);\n\nAjaxUploader.propTypes = {\n  id: PropTypes.string,\n  component: PropTypes.string,\n  style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  className: PropTypes.string,\n  multiple: PropTypes.bool,\n  directory: PropTypes.bool,\n  disabled: PropTypes.bool,\n  accept: PropTypes.string,\n  children: PropTypes.any,\n  onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  onProgress: PropTypes.func,\n  withCredentials: PropTypes.bool,\n  openFileDialogOnClick: PropTypes.bool\n};\nexport default AjaxUploader;","map":{"version":3,"sources":["/Users/SHAWN/Downloads/StudyMate2/node_modules/rc-upload/es/AjaxUploader.js"],"names":["_extends","_defineProperty","_classCallCheck","_createClass","_possibleConstructorReturn","_inherits","React","Component","PropTypes","classNames","defaultRequest","getUid","attrAccept","traverseFileTree","AjaxUploader","_Component","_ref","_temp","_this","_ret","_len","arguments","length","args","Array","_key","__proto__","Object","getPrototypeOf","call","apply","concat","state","uid","reqs","onChange","e","files","target","uploadFiles","reset","onClick","el","fileInput","click","onKeyDown","key","onFileDrop","preventDefault","type","props","directory","dataTransfer","items","_file","accept","prototype","slice","filter","file","postFiles","forEach","upload","saveFileInput","node","value","componentDidMount","_isMounted","componentWillUnmount","abort","fileList","_this2","beforeUpload","setTimeout","post","before","then","processedFile","processedFileType","toString","console","log","_this3","data","onStart","onProgress","Promise","resolve","action","request","customRequest","filename","name","headers","withCredentials","onSuccess","ret","xhr","onError","err","setState","keys","render","_classNames","_props","Tag","component","prefixCls","className","disabled","id","style","multiple","children","openFileDialogOnClick","cls","events","onDrop","onDragOver","tabIndex","createElement","role","ref","display","webkitdirectory","propTypes","string","object","bool","any","func","oneOfType"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/no-is-mounted:0 react/sort-comp:0 */\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\n\nvar AjaxUploader = function (_Component) {\n  _inherits(AjaxUploader, _Component);\n\n  function AjaxUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, AjaxUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = AjaxUploader.__proto__ || Object.getPrototypeOf(AjaxUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = { uid: getUid() }, _this.reqs = {}, _this.onChange = function (e) {\n      var files = e.target.files;\n      _this.uploadFiles(files);\n      _this.reset();\n    }, _this.onClick = function () {\n      var el = _this.fileInput;\n      if (!el) {\n        return;\n      }\n      el.click();\n    }, _this.onKeyDown = function (e) {\n      if (e.key === 'Enter') {\n        _this.onClick();\n      }\n    }, _this.onFileDrop = function (e) {\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (_this.props.directory) {\n        traverseFileTree(e.dataTransfer.items, _this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.props.accept);\n        });\n      } else {\n        var files = Array.prototype.slice.call(e.dataTransfer.files).filter(function (file) {\n          return attrAccept(file, _this.props.accept);\n        });\n        _this.uploadFiles(files);\n      }\n    }, _this.uploadFiles = function (files) {\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.forEach(function (file) {\n        file.uid = getUid();\n        _this.upload(file, postFiles);\n      });\n    }, _this.saveFileInput = function (node) {\n      _this.fileInput = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(AjaxUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.abort();\n    }\n  }, {\n    key: 'upload',\n    value: function upload(file, fileList) {\n      var _this2 = this;\n\n      var props = this.props;\n\n      if (!props.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n\n      var before = props.beforeUpload(file, fileList);\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this2.post(processedFile);\n          }\n          return _this2.post(file);\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this2.post(file);\n        }, 0);\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this3 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n      var props = this.props;\n      var data = props.data;\n      var onStart = props.onStart,\n          onProgress = props.onProgress;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n      new Promise(function (resolve) {\n        var action = props.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n\n        var request = props.customRequest || defaultRequest;\n        _this3.reqs[uid] = request({\n          action: action,\n          filename: props.name,\n          file: file,\n          data: data,\n          headers: props.headers,\n          withCredentials: props.withCredentials,\n          onProgress: onProgress ? function (e) {\n            onProgress(e, file);\n          } : null,\n          onSuccess: function onSuccess(ret, xhr) {\n            delete _this3.reqs[uid];\n            props.onSuccess(ret, file, xhr);\n          },\n          onError: function onError(err, ret) {\n            delete _this3.reqs[uid];\n            props.onError(err, ret, file);\n          }\n        });\n        onStart(file);\n      });\n    }\n  }, {\n    key: 'reset',\n    value: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n        if (reqs[uid]) {\n          reqs[uid].abort();\n          delete reqs[uid];\n        }\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid]) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          prefixCls = _props.prefixCls,\n          className = _props.className,\n          disabled = _props.disabled,\n          id = _props.id,\n          style = _props.style,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          children = _props.children,\n          directory = _props.directory,\n          openFileDialogOnClick = _props.openFileDialogOnClick;\n\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      var events = disabled ? {} : {\n        onClick: openFileDialogOnClick ? this.onClick : function () {},\n        onKeyDown: this.onKeyDown,\n        onDrop: this.onFileDrop,\n        onDragOver: this.onFileDrop,\n        tabIndex: '0'\n      };\n      return React.createElement(\n        Tag,\n        _extends({}, events, {\n          className: cls,\n          role: 'button',\n          style: style\n        }),\n        React.createElement('input', {\n          id: id,\n          type: 'file',\n          ref: this.saveFileInput,\n          key: this.state.uid,\n          style: { display: 'none' },\n          accept: accept,\n          directory: directory ? 'directory' : null,\n          webkitdirectory: directory ? 'webkitdirectory' : null,\n          multiple: multiple,\n          onChange: this.onChange\n        }),\n        children\n      );\n    }\n  }]);\n\n  return AjaxUploader;\n}(Component);\n\nAjaxUploader.propTypes = {\n  id: PropTypes.string,\n  component: PropTypes.string,\n  style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  className: PropTypes.string,\n  multiple: PropTypes.bool,\n  directory: PropTypes.bool,\n  disabled: PropTypes.bool,\n  accept: PropTypes.string,\n  children: PropTypes.any,\n  onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  onProgress: PropTypes.func,\n  withCredentials: PropTypes.bool,\n  openFileDialogOnClick: PropTypes.bool\n};\n\n\nexport default AjaxUploader;"]},"metadata":{},"sourceType":"module"}